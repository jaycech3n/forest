---
title: Reflectivity of impredicative universes (work in progress)
author:
- Jonathan Sterling
date: 2023-03-11T13:39:25+01:00
macros:
- include: base-macros
- name: UU
  args: 0
  body: '\mathcal{U}'
- name: VV
  args: 0
  body: '\mathcal{V}'
- name: TpIdn
  args: 3
  body: '{#2} =_{#1} {#3}'
- name: TpHtpy
  args: 3
  body: '{#2} \sim_{#1} {#3}'
- name: IncohNatStr
  args: 0
  body: '\Con{inat}'
- name: SemicohStr
  args: 0
  body: '\Con{semicoh}'
- name: Prod
  args: 1
  body: '\prod_{#1}'
- name: Sum
  args: 1
  body: '\sum_{#1}'
- name: Alg
  args: 0
  body: \Con{Alg}
- name: AlgHom
  args: 2
  body: \Con{AlgHom}\prn{#1,#2}
---

Working in univalent foundations, let {#\UU\in\VV#} be a pair of universes such that {#\UU#} is closed under {#\VV#}-small products of {#\UU#}-small types; then the subuniverse inclusion {#\Mor{j}{\UU}{\VV}#} is *reflective*.

This argument will combine ideas due to Awodey, Frey, Speight, and [Shulman](https://homotopytypetheory.org/2018/11/26/impredicative-encodings-part-3/). For any type {#A\in\VV#} be a type, we will define the reflection of {#A#} in {#\UU#} in several steps.

We first define a {#\UU#}-small {#A#}-algebra to be a type {#B:\UU#} together with a function {#\Mor{\beta}{A}{B}#}. Writing {#\Alg#} for the type of {#\UU#}-small {#A#}-algebras, given {#B:\Alg#} we will often write {#B:\UU#} to refer to the underlying type, and we will write {#\Mor{\alpha_B}{A}{B}#} for the structure map.

Note that any product of algebras carries a canonical algebra structure determined by the algebra structures on its components. In particular, given {#I:\VV#} and {#B:I\to\Alg#}, the structure map for the product {#\Prod{i:I}Bi#} is given as follows:

{##
  \begin{array}{l}
    \alpha\Sub{\Prod{i:I}Bi}: A\to \Prod{i:I}Bi\\
    \alpha\Sub{\Prod{i:I}Bi}\,a\,i = \alpha\Sub{Bi} a
  \end{array}
##}

We define our first approximant {#H:\Alg#} of the {#\UU#}-reflection of {#A#} to be the product of all {#A#}-algebras:
{##
  H :\equiv \Prod{B:\Alg} B
##}

Given {#u:H#} and {#C:\UU#}, we may write {#u_C : C^A \to C#} for the function {#u_C h :\equiv u\,\prn{C,h}#}. With this in hand, we may define the type of *incoherent naturality structures* on an element of {#H#}:

{##
  \begin{array}{l}
    \IncohNatStr : H\to \UU\\
    \IncohNatStr\, u :\equiv 
    \Prod{C,D:\UU}
    \Prod{f:C\to D}
    \TpHtpy{\prn{A\to C}\to D}{\prn{f\circ u_C}}{\prn{u_D\circ f^A}}
  \end{array}
##}

Next, we define the type of *semicoherence structures* on an incoherent naturality structure:

{##
  \begin{array}{l}
    \SemicohStr : 
    \Prod{u:H}
    \IncohNatStr\,u\to \UU
    \\
    \SemicohStr\,u\,\theta :\equiv
    \\
    \begin{array}{l}
      \Prod{C,D,E:\UU}
      \Prod{f:C\to D}
      \Prod{g:D\to E}\\
      \TpIdn{
        \TpHtpy{\prn{C^A\to E}}{g\circ f\circ u_C}{u_E\circ \prn{g\circ f}^A}
      }{
        \theta\Sub{C,E}\prn{g\circ f}
      }{
        \prn{g \ast \theta\Sub{C,D}f} \cdot \prn{\theta\Sub{D,E}g \ast f^A}
      }
    \end{array}
  \end{array}
##}

Note that the above is well-typed by virtue of the fact that postcomposition of functions is *definitionally* associative. The semicoherence structure is requiring a witness for the following triangle of homotopies in {#C^A\to E#}:
```render-latex
\begin{tikzpicture}[diagram]
\node (nw) {$g\circ f\circ u_C$};
\node[below right = 3.5cm of nw] (s) {$g\circ u_D\circ f^A$};
\node[above right = 3.5cm of s] (ne) {$u_E\circ \prn{g\circ f}^A$};
\draw[->] (nw) to node[above] {$\theta\Sub{C,E}\prn{g\circ f}$} (ne);
\draw[->] (nw) to node[sloped,below] {$g\ast \theta\Sub{C,D}f$} (s);
\draw[->] (s) to node[sloped,below] {$\theta\Sub{D,E}g\ast f^A$} (ne);
\end{tikzpicture}
```

We define {#I#} to be the dependent sum {#\Sum{u:H}\Sum{\theta:\IncohNatStr\,u}\SemicohStr\,u\,\theta#}. We will show that the structure map {#\Mor{\alpha_H}{A}{H}#} factors through the projection {#\Mor{\pi_1}{I}{H}#} by exhibiting a semicoherent naturality structure on each {#\alpha_H a \equiv \prn{\lambda B. \alpha_B a}:H#} for {#a:A#}. In particular, we define the incoherent naturality structure by reflexivity as follows:
{##
  \begin{array}{l}
    \theta\Sup{\alpha_Ha} : \Con{inat}\,\prn{\alpha_Ha}\\
    \theta\SubSup{C,D}{\alpha_Ha}\,\prn{\Mor{f}{C}{D}} :\equiv
    \lambda \Mor{h}{A}{C}.
    \Con{refl}\Sub{f\prn{h\prn{a}}}
  \end{array}
##}

The semicoherence structure is by reflexivity as well; this follows from the definitional computation rules of homotopy whiskering and path concatenation with respect to reflexivity:
{##
  \begin{array}{l}
    \mathfrak{c}\Sup{\alpha_Ha} : \SemicohStr\,\prn{\alpha_Ha}\,\theta\Sup{\alpha_Ha}\\
    \mathfrak{c}\SubSup{C,D,E}{\alpha_Ha}\,f\,g :\equiv 
    \Con{refl}\Sub{\lambda h. \Con{refl}\Sub{g\,\prn{f\prn{h\prn{a}}}}}
  \end{array}
##}

Therefore, we may define a structure map {#\Mor{\alpha_I}{A}{I}#} to make {#\Mor{\alpha_H}{A}{H}#} a (definitional) homomorphism of algebras, setting {#\alpha_I a :\equiv \prn{\alpha_Ha,\theta\Sup{\alpha_Ha},\mathfrak{c}\Sup{\alpha_Ha}}#}:

```render-latex
\begin{tikzpicture}[diagram]
\node (sw) {$I$};
\node[above right = of sw] (n) {$A$};
\node[below right = of n] (se) {$H$};
\draw[->] (n) to node[sloped,above] {$\alpha_I$} (sw);
\draw[->] (n) to node[sloped,above] {$\alpha_H$} (se);
\draw[->] (sw) to node[below] {$\pi_1$} (se);
\end{tikzpicture}
```

For {#I#} to be the reflection of {#A#} in {#\UU#} would mean that the type of homomorphisms of algebras from {#I#} to {#B#} for any {#B:\Alg#} is contractible. Unfortunately, this will not be the case (though it would hold if every type in {#\UU#} were a set). In order to solve this problem, we will use an idea of Mike Shulman.

Given any algebra {#B:\Alg#}, we may define a function {#\Mor{e_B}{H}{B}#} sending each {#u:\Prod{C:\Alg}C#} to {#e_Bu:\equiv uB#}; this is evidently a (definitional) homomorphism of algebras, since we have {#e_B\prn{\alpha_Ha} \equiv \alpha_H\,a\,B \equiv \alpha_B a#} by definition. Therefore, it follows that we have a definitional homomorphism {#\Mor{p_B}{I}{B}#} as the composite {#I\xrightarrow{\pi_1}H\xrightarrow{e_B}B#}. 

The assignment {#p:\Prod{B:\Alg}\AlgHom{I}{B}#} sending {#B:\Alg#} to the homomorphism {#\prn{p_B, \Con{refl}\Sub{\alpha_B}}#} is furthermore (incoherently) natural in {#B:\Con{Alg}#}. In particular, given any homomorphism of algebras {#\Mor{\prn{h,\alpha_h}}{B}{C}#} there is a homotopy {#\chi_h#} witnessing that the following triangle commutes:
```render-latex
\begin{tikzpicture}[diagram]
\node (sw) {$B$};
\node[above right = of sw] (n) {$I$};
\node[below right = of n] (se) {$C$};
\draw[->] (n) to node[sloped,above] {$p_B$} (sw);
\draw[->] (sw) to node[below] (h) {$h$} (se);
\draw[->] (n) to node[sloped,above] {$p_C$} (se);
\node[between = n and h] {$\chi_h$};
\end{tikzpicture}
```

Note that by path induction on the pair {#\prn{\alpha_C,\alpha_h}#}, we may assume in what follows that {#\alpha_C \equiv h\circ\alpha_B#} by definition and so {#h#} is a definitional homomorphism. Then the homotopy {#\chi_h : \TpHtpy{I\to C}{h\circ p_B}{p_C}#} is projected from the incoherent naturality structure associated to each {#u:I#}; in particular, we may define {#\chi_hu :\equiv \theta\SubSup{B,C}{u}\,h\,\alpha_B#}.

In particular, we may consider the homotopy {#\chi\Sub{p_I} : \TpHtpy{I\to I}{p_I\circ p_I}{p_I}#}, which is defined to be the homotopy mapping {#u:I#} to {#\theta^u_{I,I}\,p_I\,\alpha_{I}#}. The homotopy {#\chi\Sub{p_I}#} witnesses that {#p_I#} is a *pre-idempotent* in the sense of Shulman; the semicoherence structure {#\mathfrak{c}\Sup{u}#} on each {#u:I#} will, however, imply that {#p_I#} is *quasi-idempotent*, and therefore splits.  In particular, we must find a witness of the following type:

{##
  \Prod{u:I}
  \Con{ap}_{p_I}\prn{\chi_{p_I}u} = \chi_{p_I}\prn{p_Iu}
##}

For each {#u:I#}, this is to construct an identification of the following form:

{##
\Con{ap}\Sub{p_I}\prn{\theta\SubSup{I,I}{u}\,p_I\,\alpha_I} 
=
\theta\SubSup{I,I}{p_Iu}\,p_I\,\alpha_I
##}

<span style="color:red;font-weight: bold">
This is the part I don't see how to do. I end up needing to identify a term involving the incoherent naturality structure for {#u#} with a term involving the incoherent naturality structure for {#p_Iu#}, but there is nothing that relates these. But Shulman said the following:
</span>

>  And in our situation, we can obtain this one additional coherence condition for the naturality triangle {#p_I \circ p_I = p_I#} by using the 1-type version of the Awodey-Frey-Speight construction. (Actually, we can even omit their unit condition; all we need is the composition coherence for pseudonaturality.)
