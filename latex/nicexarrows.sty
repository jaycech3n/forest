%% Adapted from https://tex.stackexchange.com/a/601996/1512
\RequirePackage{mathtools,tikz-cd}
% The following uses tikz-cd to define retractable arrows to avoid problems with unicode-math.
\newbox\xratbelow
\newbox\xratabove
% Redefine \xrightarrow[below]{above}
\renewcommand{\xrightarrow}[2][]{%
    \setbox\xratbelow=\hbox{\ensuremath{\scriptscriptstyle #1}}%
    \setbox\xratabove=\hbox{\ensuremath{\scriptscriptstyle #2}}%
    \pgfmathsetlengthmacro{\xratlen}{max(\wd\xratbelow, \wd\xratabove) + .8em}%
    \mathrel{\tikz [->, baseline=-.6ex, every node/.style={inner sep=0pt}]
        \draw (0,0) -- node[below=1pt] {\box\xratbelow}
        node[above=1pt] {\box\xratabove}
        (\xratlen,0) ;}}
% Redefine \xlefttarrow[below]{above}
\renewcommand{\xleftarrow}[2][]{%
    \setbox\xratbelow=\hbox{\ensuremath{\scriptscriptstyle #1}}%
    \setbox\xratabove=\hbox{\ensuremath{\scriptscriptstyle #2}}%
    \pgfmathsetlengthmacro{\xratlen}{max(\wd\xratbelow, \wd\xratabove) + .8em}%
    \mathrel{\tikz [<-, baseline=-.6ex, every node/.style={inner sep=0pt}]
        \draw (0,0) -- node[below=1pt] {\box\xratbelow}
        node[above=1pt] {\box\xratabove}
        (\xratlen,0) ;}}
% Redefine \xleftrightarrow[below]{above}
\renewcommand{\xleftrightarrow}[2][]{%
    \setbox\xratbelow=\hbox{\ensuremath{\scriptscriptstyle #1}}%
    \setbox\xratabove=\hbox{\ensuremath{\scriptscriptstyle #2}}%
    \pgfmathsetlengthmacro{\xratlen}{max(\wd\xratbelow, \wd\xratabove) + .8em}%
    \mathrel{\tikz [<->, baseline=-.6ex, every node/.style={inner sep=0pt}]
        \draw (0,0) -- node[below=1pt] {\box\xratbelow}
        node[above=1pt] {\box\xratabove}
        (\xratlen,0) ;}}
% Redefine \xhookrightarrow[below]{above}, using the hookrightarrow from tikz-cd
\renewcommand{\xhookrightarrow}[2][]{%
    \setbox\xratbelow=\hbox{\ensuremath{\scriptscriptstyle #1}}%
    \setbox\xratabove=\hbox{\ensuremath{\scriptscriptstyle #2}}%
    \pgfmathsetlengthmacro{\xratlen}{max(\wd\xratbelow, \wd\xratabove) + .8em}%
    \mathrel{\tikz [baseline=-.6ex, every node/.style={inner sep=0pt}]
        \draw (0,0) edge[commutative diagrams/hookrightarrow] node[below=1pt] {\box\xratbelow}
        node[above=1pt] {\box\xratabove}
        (\xratlen,0) ;}}
% Redefine \xhooklefttarrow[below]{above}, using the hookleftarrow from tikz-cd
\renewcommand{\xhookleftarrow}[2][]{%
    \setbox\xratbelow=\hbox{\ensuremath{\scriptscriptstyle #1}}%
    \setbox\xratabove=\hbox{\ensuremath{\scriptscriptstyle #2}}%
    \pgfmathsetlengthmacro{\xratlen}{max(\wd\xratbelow, \wd\xratabove) + .8em}%
    \mathrel{\tikz [baseline=-.6ex, every node/.style={inner sep=0pt}]
        \draw (0,0) edge[commutative diagrams/hookleftarrow] node[below=1pt] {\box\xratbelow}
        node[above=1pt] {\box\xratabove}
        (\xratlen,0) ;}}
% Redefine \xmapsto[below]{above}, using the mapsto from tikz-cd
\renewcommand{\xmapsto}[2][]{%
    \setbox\xratbelow=\hbox{\ensuremath{\scriptscriptstyle #1}}%
    \setbox\xratabove=\hbox{\ensuremath{\scriptscriptstyle #2}}%
    \pgfmathsetlengthmacro{\xratlen}{max(\wd\xratbelow, \wd\xratabove) + .8em}%
    \mathrel{\tikz [baseline=-.6ex, every node/.style={inner sep=0pt}]
        \draw (0,0) edge[commutative diagrams/mapsto] node[below=1pt] {\box\xratbelow}
        node[above=1pt] {\box\xratabove}
        (\xratlen,0) ;}}
% Define \xlongequal[below]{above}, using the equal from tikz-cd
\newcommand{\xlongequal}[2][]{%
    \setbox\xratbelow=\hbox{\ensuremath{\scriptscriptstyle #1}}%
    \setbox\xratabove=\hbox{\ensuremath{\scriptscriptstyle #2}}%
    \pgfmathsetlengthmacro{\xratlen}{max(\wd\xratbelow, \wd\xratabove) + .8em}%
    \mathrel{\tikz [baseline=-.6ex, every node/.style={inner sep=0pt}]
        \draw (0,0) edge[commutative diagrams/equal] node[below=1pt] {\box\xratbelow}
        node[above=1pt] {\box\xratabove}
        (\xratlen,0) ;}}





