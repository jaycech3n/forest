{{ $page := .page }}
{{ $slug := $page.File.ContentBaseName }}

{{ $fwdPages := slice }}
{{ $bwdPages := slice }}
{{ $dwdPages := slice }}
{{ $upwdPages := slice }}
{{ $refPages := slice }}

{{ with site.Data.forest }}
  {{ with .linksTo }}
    {{ range index . $slug }}
      {{ with site.GetPage . }}
        {{ $bwdPages = $bwdPages | append . }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{ with .linksFrom }}
    {{ range index . $slug }}
      {{ with site.GetPage . }}
        {{ if eq .Type "refs" }}
          {{ $refPages = $refPages | append . }}
        {{ else }}
          {{ $fwdPages = $fwdPages | append . }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{ with .parentsOf }}
    {{ range index . $slug }}
      {{ with site.GetPage . }}
        {{ $upwdPages = $upwdPages | append . }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{ with .childrenOf }}
    {{ range index . $slug }}
      {{ with site.GetPage . }}
        {{ $dwdPages = $dwdPages | append . }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{ with $upwdPages }}
  {{ partial "links_section" (dict "pages" . "title" "Context")}}
  {{ end }}

  {{ with $fwdPages }}
  {{ partial "links_section" (dict "pages" . "title" "Related")}}
  {{ end }}

  {{ with $bwdPages }}
  {{ partial "links_section" (dict "pages" . "title" "Backlinks")}}
  {{ end }}

  {{ with $refPages }}
  {{ partial "links_section" (dict "pages" . "title" "References")}}
  {{ end }}

{{ end }}
