
{{ $url := urls.Parse .Destination }}
{{ $isLocal := not $url.Host }}
{{ $transcludedPage := site.GetPage $url.Path }}
{{ if and $isLocal $transcludedPage }}
{{ $query := $url.Query }}
{{ $transcludedSlug := .Destination }}
{{ $page := .Page }}
{{ $splice := eq ($query.Get "splice") "true" }}
{{ $collapse := or $page.Params.collapseChildren (eq ($query.Get "collapse") "true") }}
{{- $treePartialCacheKey := (dict "slug" .Destination "collapse" $collapse "isRoot" false "splice" $splice)}}
{{ partialCached "tree.html"
    (dict "context" $transcludedPage
          "collapse" $collapse
          "splice" $splice
          "isRoot" false)
    $treePartialCacheKey }}
{{ else }}
<img src="{{ .Destination | safeURL }}" alt="{{ .Text }}" {{ with .Title}} title="{{ . }}"{{ end }} />
{{ end }}

